<?php require_once(PATH_ROOT_CLASES . 'cdatabase.php'); require_once(PATH_ROOT_CLASES . 'cimagen.php'); require_once(PATH_ROOT_CLASES . 'cutils.php'); require_once(PATH_ROOT_CLASES . 'cpaginado.php');  class Cchangepass { 	var $m_id; 	var $m_name_stripped; 	var $m_multilanguage; 	var $m_type; 	var $m_password; 	var $m_stripped;  	function Cchangepass( $id = '', $password = ''){   		$this->m_name_stripped 	 = 	 'password'; 		$this->m_multilanguage 	 = 	 false; 		$this->m_type 	 = 	 'webform'; 		if ($id == ''){			$this->m_password	= $password;			$this->m_stripped =  Cutils::to_stripped($this->m_password); 		}else{			$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );			$query = "SELECT id, password, stripped, created, updated FROM changepass WHERE id=$id ";			$item = $con->fetch_one_result($query);			if ($item){				$this->m_id 	 = $item['id'];				$this->m_password	= $item['password'];				$this->m_stripped 	 = $item['stripped']; 			}else{				$this->m_id = null;			}		}	}	function save(){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$sql = "INSERT INTO changepass (password, stripped) VALUES ('". $this->m_password ."',  '".$this->m_stripped."')";		$result = $con->insert( $sql );		if ($result)			return true; 		else 			return false;	}	function edit($password = ''){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$query = "UPDATE changepass SET "; 		$query .= ($password !== '') 	 ? "password='$password', " : "" ;		$query .= ($password !== '') 	 ? "stripped='".Cutils::to_stripped($password)."' ," : "" ;   		$query .= " updated=now()";		$query .= " WHERE id=".$this->m_id."; ";		$result = $con->update($query);		if ($result)			return true; 		else 			return false;	}	function delete(){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$item = $this->load_item_to_array(); 		$sql = "DELETE from changepass WHERE id=".$this->m_id."; ";		$result = $con->delete($sql);		if ($result){			return true; 		}else 			return false;	}	function load_item_to_array(){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$query = "SELECT id, password, stripped, created, updated FROM changepass WHERE id=".$this->m_id." ;";		$item = $con->fetch_one_result($query);		if ($item == 0 || $item == -2)			return false; 		else 			return $item;	}	static function item_list($max = '', $pag = 1){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$max_rows = '';		$query = "SELECT id, password, stripped, created, updated FROM changepass ORDER BY id desc ";		if ($max!='' && $max>0){			$offset = ($pag - 1) * $max;			$query_max = "SELECT count(id) as max FROM changepass"; 			$result_max = $con->fetch_one_result($query_max);			$max_rows = ($result_max) ? $result_max['max'] : '';			if ($offset > $max_rows) $offset = 0;			$query .= " LIMIT $max OFFSET $offset "; 		}		$item = $con->fetch_array($query);		if ($max_rows == ''){ 			$max_rows = count($item);		}		if ($item)			return array('item' => $item, 'total' => $max_rows);		else 			return false;	}	function exists(){		if ($this->m_id != null)			return true; 		else			return false; 	}	static function get_id_from_stripped($stripped){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$lng = Cutils::get_actual_lng();		$query = "SELECT id FROM changepass WHERE stripped='$stripped'; "; 		$item = $con->fetch_one_result($query);		if ($item)			return $item['id']; 		else			return false; 	}	function is_unique($stripped){	$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER ); 		$query = "SELECT * FROM changepass WHERE stripped = '".Cutils::to_stripped($stripped)."' ;"; 		$item = $con->fetch_one_result($query);		if ($item)			return false; 		else			return true; 	}	static function get_strippeds ($stripped, $relation_id = ''){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER ); 		$lng = Cutils::get_actual_lng();		$query = "SELECT stripped FROM changepass WHERE stripped_$lng = '$stripped'  ";		$item = $con->fetch_one_result($query);		if ($item)			return $item; 		else			return false; 	}	static function get_type (){		return 'webform'; 	}	static function get_name_stripped (){		return 'password'; 	}	static function is_multilanguage (){		return false; 	}}?>