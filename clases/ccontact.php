<?php require_once(PATH_ROOT_CLASES . 'cdatabase.php'); require_once(PATH_ROOT_CLASES . 'cimagen.php'); require_once(PATH_ROOT_CLASES . 'cutils.php'); require_once(PATH_ROOT_CLASES . 'cpaginado.php');  class Ccontact { 	var $m_id; 	var $m_name_stripped; 	var $m_multilanguage; 	var $m_type; 	var $m_nom; 	var $m_poblacio; 	var $m_email; 	var $m_telefon; 	var $m_comentaris; 	var $m_stripped;  	function Ccontact( $id = '', $nom = '', $poblacio = '', $email = '', $telefon = '', $comentaris = ''){   		$this->m_name_stripped 	 = 	 'nom'; 		$this->m_multilanguage 	 = 	 false; 		$this->m_type 	 = 	 'webform'; 		if ($id == ''){			$this->m_nom	= $nom;			$this->m_poblacio	= $poblacio;			$this->m_email	= $email;			$this->m_telefon	= $telefon;			$this->m_comentaris	= $comentaris;			$this->m_stripped =  Cutils::to_stripped($this->m_nom); 		}else{			$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );			$query = "SELECT id, nom, poblacio, email, telefon, comentaris, stripped, created, updated FROM contact WHERE id=$id ";			$item = $con->fetch_one_result($query);			if ($item){				$this->m_id 	 = $item['id'];				$this->m_nom	= $item['nom'];				$this->m_poblacio	= $item['poblacio'];				$this->m_email	= $item['email'];				$this->m_telefon	= $item['telefon'];				$this->m_comentaris	= $item['comentaris'];				$this->m_stripped 	 = $item['stripped']; 			}else{				$this->m_id = null;			}		}	}	function save(){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$sql = "INSERT INTO contact (nom, poblacio, email, telefon, comentaris, stripped) VALUES ('". $this->m_nom ."', '". $this->m_poblacio ."', '". $this->m_email ."', '". $this->m_telefon ."', '". $this->m_comentaris ."',  '".$this->m_stripped."')";		$result = $con->insert( $sql );		if ($result)			return true; 		else 			return false;	}	function edit($nom = '', $poblacio = '', $email = '', $telefon = '', $comentaris = ''){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$query = "UPDATE contact SET "; 		$query .= ($nom !== '') 	 ? "nom='$nom', " : "" ;		$query .= ($poblacio !== '') 	 ? "poblacio='$poblacio', " : "" ;		$query .= ($email !== '') 	 ? "email='$email', " : "" ;		$query .= ($telefon !== '') 	 ? "telefon='$telefon', " : "" ;		$query .= "comentaris='$comentaris', "  ;		$query .= ($nom !== '') 	 ? "stripped='".Cutils::to_stripped($nom)."' ," : "" ;   		$query .= " updated=now()";		$query .= " WHERE id=".$this->m_id."; ";		$result = $con->update($query);		if ($result)			return true; 		else 			return false;	}	function delete(){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$item = $this->load_item_to_array(); 		$sql = "DELETE from contact WHERE id=".$this->m_id."; ";		$result = $con->delete($sql);		if ($result){			return true; 		}else 			return false;	}	function load_item_to_array(){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$query = "SELECT id, nom, poblacio, email, telefon, comentaris, stripped, created, updated FROM contact WHERE id=".$this->m_id." ;";		$item = $con->fetch_one_result($query);		if ($item == 0 || $item == -2)			return false; 		else 			return $item;	}	static function item_list($max = '', $pag = 1){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$max_rows = '';		$query = "SELECT id, nom, poblacio, email, telefon, comentaris, stripped, created, updated FROM contact ORDER BY id desc ";		if ($max!='' && $max>0){			$offset = ($pag - 1) * $max;			$query_max = "SELECT count(id) as max FROM contact"; 			$result_max = $con->fetch_one_result($query_max);			$max_rows = ($result_max) ? $result_max['max'] : '';			if ($offset > $max_rows) $offset = 0;			$query .= " LIMIT $max OFFSET $offset "; 		}		$item = $con->fetch_array($query);		if ($max_rows == ''){ 			$max_rows = count($item);		}		if ($item)			return array('item' => $item, 'total' => $max_rows);		else 			return false;	}	function exists(){		if ($this->m_id != null)			return true; 		else			return false; 	}	static function get_id_from_stripped($stripped){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$lng = Cutils::get_actual_lng();		$query = "SELECT id FROM contact WHERE stripped='$stripped'; "; 		$item = $con->fetch_one_result($query);		if ($item)			return $item['id']; 		else			return false; 	}	function is_unique($stripped){	$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER ); 		$query = "SELECT * FROM contact WHERE stripped = '".Cutils::to_stripped($stripped)."' ;"; 		$item = $con->fetch_one_result($query);		if ($item)			return false; 		else			return true; 	}	static function get_strippeds ($stripped, $relation_id = ''){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER ); 		$lng = Cutils::get_actual_lng();		$query = "SELECT stripped FROM contact WHERE stripped_$lng = '$stripped'  ";		$item = $con->fetch_one_result($query);		if ($item)			return $item; 		else			return false; 	}	static function get_type (){		return 'webform'; 	}	static function get_name_stripped (){		return 'nom'; 	}	static function is_multilanguage (){		return false; 	}}?>