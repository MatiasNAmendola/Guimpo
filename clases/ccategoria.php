<?php require_once(PATH_ROOT_CLASES . 'cdatabase.php'); require_once(PATH_ROOT_CLASES . 'cimagen.php'); require_once(PATH_ROOT_CLASES . 'cutils.php'); require_once(PATH_ROOT_CLASES . 'cpaginado.php');  class Ccategoria { 	var $m_id; 	var $m_name_stripped; 	var $m_multilanguage; 	var $m_type; 	var $m_name_es; 	var $m_name_ca; 	var $m_name_en; 	var $m_descripcion; 	var $m_stripped_es; 	var $m_stripped_ca; 	var $m_stripped_en; 	function Ccategoria( $id = '', $name_es = '', $name_ca = '', $name_en = '', $descripcion = ''){   		$this->m_name_stripped 	 = 	 'name'; 		$this->m_multilanguage 	 = 	 true; 		$this->m_type 	 = 	 'webform'; 		if ($id == ''){			$this->m_name_es	= $name_es;			$this->m_name_ca	= $name_ca;			$this->m_name_en	= $name_en;			$this->m_descripcion	= $descripcion;			$this->m_stripped_es = Cutils::to_stripped($this->m_name_es); 			$this->m_stripped_ca = Cutils::to_stripped($this->m_name_ca); 			$this->m_stripped_en = Cutils::to_stripped($this->m_name_en); 		}else{			$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );			$query = "SELECT id, name_es, name_ca, name_en, descripcion, stripped_es, stripped_ca, stripped_en, created, updated FROM categoria WHERE id=$id ";			$item = $con->fetch_one_result($query);			if ($item){				$this->m_id 	 = $item['id'];				$this->m_name_es	= $item['name_es'];				$this->m_name_ca	= $item['name_ca'];				$this->m_name_en	= $item['name_en'];				$this->m_descripcion	= $item['descripcion'];				$this->m_stripped_es	 = $item['stripped_es']; 				$this->m_stripped_ca	 = $item['stripped_ca']; 				$this->m_stripped_en	 = $item['stripped_en']; 			}else{				$this->m_id = null;			}		}	}	function save(){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$sql = "INSERT INTO categoria (name_es, name_ca, name_en, descripcion, stripped_es, stripped_ca, stripped_en) VALUES ('". $this->m_name_es ."', '". $this->m_name_ca ."', '". $this->m_name_en ."', '". $this->m_descripcion ."', '". $this->m_stripped_es ."', '". $this->m_stripped_ca ."', '". $this->m_stripped_en ."')";		$result = $con->insert( $sql );		if ($result)			return true; 		else 			return false;	}	function edit($name_es = '', $name_ca = '', $name_en = '', $descripcion = ''){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$query = "UPDATE categoria SET "; 		$query .= ($name_es !== '') 	 ? " name_es='$name_es', " : "" ;		$query .= ($name_ca !== '') 	 ? " name_ca='$name_ca', " : "" ;		$query .= ($name_en !== '') 	 ? " name_en='$name_en', " : "" ;		$query .= "descripcion='$descripcion', "  ;		$query .= ($name_es !== '') 	 ? "stripped_es='".Cutils::to_stripped($name_es)."' ," : "" ;   		$query .= ($name_ca !== '') 	 ? "stripped_ca='".Cutils::to_stripped($name_ca)."' ," : "" ;   		$query .= ($name_en !== '') 	 ? "stripped_en='".Cutils::to_stripped($name_en)."' ," : "" ;   		$query .= " updated=now()";		$query .= " WHERE id=".$this->m_id."; ";		$result = $con->update($query);		if ($result)			return true; 		else 			return false;	}	function delete(){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$item = $this->load_item_to_array(); 		$sql = "DELETE from categoria WHERE id=".$this->m_id."; ";		$result = $con->delete($sql);		if ($result){			return true; 		}else 			return false;	}	function load_item_to_array(){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$query = "SELECT id, name_es, name_ca, name_en, descripcion, stripped_es, stripped_ca, stripped_en, created, updated FROM categoria WHERE id=".$this->m_id." ;";		$item = $con->fetch_one_result($query);		if ($item == 0 || $item == -2)			return false; 		else 			return $item;	}	static function item_list($max = '', $pag = 1){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$max_rows = '';		$query = "SELECT id, name_es, name_ca, name_en, descripcion, stripped_es, stripped_ca, stripped_en, created, updated FROM categoria ORDER BY id desc ";		if ($max!='' && $max>0){			$offset = ($pag - 1) * $max;			$query_max = "SELECT count(id) as max FROM categoria"; 			$result_max = $con->fetch_one_result($query_max);			$max_rows = ($result_max) ? $result_max['max'] : '';			if ($offset > $max_rows) $offset = 0;			$query .= " LIMIT $max OFFSET $offset "; 		}		$item = $con->fetch_array($query);		if ($max_rows == ''){ 			$max_rows = count($item);		}		if ($item)			return array('item' => $item, 'total' => $max_rows);		else 			return false;	}	function exists(){		if ($this->m_id != null)			return true; 		else			return false; 	}	static function get_id_from_stripped($stripped){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$lng = Cutils::get_actual_lng();		$query = "SELECT id FROM categoria WHERE stripped_$lng ='$stripped'; "; 		$item = $con->fetch_one_result($query);		if ($item)			return $item['id']; 		else			return false; 	}	function is_unique($stripped_es, $stripped_ca, $stripped_en){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER ); 		$lng = Cutils::get_actual_lng();		$query = "SELECT  * FROM categoria WHERE stripped_es = '".Cutils::to_stripped($stripped_es)."' or stripped_ca = '".Cutils::to_stripped($stripped_ca)."' or stripped_en = '".Cutils::to_stripped($stripped_en)."'";		$item = $con->fetch_one_result($query);		if ($item)			return false; 		else			return true; 	}	static function get_strippeds ($stripped, $relation_id = ''){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER ); 		$lng = Cutils::get_actual_lng();		$query = "SELECT stripped_es, stripped_ca, stripped_en FROM categoria WHERE stripped_$lng = '$stripped'  ";		$item = $con->fetch_one_result($query);		if ($item)			return $item; 		else			return false; 	}	static function get_type (){		return 'webform'; 	}	static function get_name_stripped (){		return 'name'; 	}	static function is_multilanguage (){		return true; 	}}?>