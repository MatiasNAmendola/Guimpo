<?php require_once(PATH_ROOT_CLASES . 'cdatabase.php'); require_once(PATH_ROOT_CLASES . 'cimagen.php'); require_once(PATH_ROOT_CLASES . 'cutils.php'); require_once(PATH_ROOT_CLASES . 'cpaginado.php');  class Ccategoria { 	var $m_id; 	var $m_name_stripped; 	var $m_multilanguage; 	var $m_type; 	var $m_name; 	var $m_file; 	var $m_stripped;  	function Ccategoria( $id = '', $name = '', $file = ''){   		$this->m_name_stripped 	 = 	 'name'; 		$this->m_multilanguage 	 = 	 false; 		$this->m_type 	 = 	 'webform'; 		if ($id == ''){			$this->m_name	= $name;			$this->m_file	= $file;			$this->m_stripped =  Cutils::to_stripped($this->m_name); 		}else{			$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );			$query = "SELECT id, name, file, stripped, created, updated FROM categoria WHERE id=$id ";			$item = $con->fetch_one_result($query);			if ($item){				$this->m_id 	 = $item['id'];				$this->m_name	= $item['name'];				$this->m_file	= $item['file'];				$this->m_stripped 	 = $item['stripped']; 			}else{				$this->m_id = null;			}		}	}	function save(){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$sql = "INSERT INTO categoria (name, file, stripped) VALUES ('". $this->m_name ."', '". $this->m_file ."',  '".$this->m_stripped."')";		$result = $con->insert( $sql );		if ($result)			return true; 		else 			return false;	}	function edit($name = '', $file = ''){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$query = "UPDATE categoria SET "; 		$query .= ($name !== '') 	 ? "name='$name', " : "" ;		$query .= ($file !== '') 	 ? "file='$file', " : "" ;		$query .= ($name !== '') 	 ? "stripped='".Cutils::to_stripped($name)."' ," : "" ;   		$query .= " updated=now()";		$query .= " WHERE id=".$this->m_id."; ";		$result = $con->update($query);		if ($result)			return true; 		else 			return false;	}	function delete(){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$item = $this->load_item_to_array(); 		$sql = "DELETE from categoria WHERE id=".$this->m_id."; ";		$result = $con->delete($sql);		if ($result){			//Borramos el archivo			Carchivo::delete($item['file']); 			return true; 		}else 			return false;	}	function load_item_to_array(){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$query = "SELECT id, name, file, stripped, created, updated FROM categoria WHERE id=".$this->m_id." ;";		$item = $con->fetch_one_result($query);		if ($item == 0 || $item == -2)			return false; 		else 			return $item;	}	static function item_list($max = '', $pag = 1){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$max_rows = '';		$query = "SELECT id, name, file, stripped, created, updated FROM categoria ORDER BY id desc ";		if ($max!='' && $max>0){			$offset = ($pag - 1) * $max;			$query_max = "SELECT count(id) as max FROM categoria"; 			$result_max = $con->fetch_one_result($query_max);			$max_rows = ($result_max) ? $result_max['max'] : '';			if ($offset > $max_rows) $offset = 0;			$query .= " LIMIT $max OFFSET $offset "; 		}		$item = $con->fetch_array($query);		if ($max_rows == ''){ 			$max_rows = count($item);		}		if ($item)			return array('item' => $item, 'total' => $max_rows);		else 			return false;	}	function exists(){		if ($this->m_id != null)			return true; 		else			return false; 	}	static function get_id_from_stripped($stripped){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER );		$lng = Cutils::get_actual_lng();		$query = "SELECT id FROM categoria WHERE stripped='$stripped'; "; 		$item = $con->fetch_one_result($query);		if ($item)			return $item['id']; 		else			return false; 	}	function is_unique($stripped){	$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER ); 		$query = "SELECT * FROM categoria WHERE stripped = '".Cutils::to_stripped($stripped)."' ;"; 		$item = $con->fetch_one_result($query);		if ($item)			return false; 		else			return true; 	}	static function get_strippeds ($stripped, $relation_id = ''){		$con = new cdatabase(array('host'=>HOST, 'user'=>USER, 'dbname'=>DBNAME, 'password'=>PASSWORD), DBDRIVER ); 		$lng = Cutils::get_actual_lng();		$query = "SELECT stripped FROM categoria WHERE stripped_$lng = '$stripped'  ";		$item = $con->fetch_one_result($query);		if ($item)			return $item; 		else			return false; 	}	static function get_type (){		return 'webform'; 	}	static function get_name_stripped (){		return 'name'; 	}	static function is_multilanguage (){		return false; 	}}?>