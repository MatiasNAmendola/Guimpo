<?php require_once(PATH_ROOT_CLASES . 'cdatabase.php'); require_once(PATH_ROOT_CLASES . 'cpaginado.php');  require_once(PATH_ROOT_CLASES . 'cform_construct.php');  class Cform_construct_categoria_gallery extends  Cform_construct {	var $m_item_id;	var $m_relation_id;	var $m_return;	function Cform_construct_categoria_gallery($form_name = '', $lng = 'es', $type = 'new', $item_id = '', $relation_id = '', $return = '' ){		$this->m_relation_id = $relation_id;		$this->m_return = $return;		$this->m_item_id = $item_id;		Cform_construct_categoria_gallery::Cform_construct($form_name, $lng, $type); 	}	function get_item_id(){		return $this->m_item_id; 	} 	function populate($fillbd = true){		$this->m_form_object = new Cform($this->get_form_name(), $this->get_form_name(), htmlentities($_SERVER['PHP_SELF'], ENT_QUOTES), 'post'); 		$obj = new Cform_text('name_es',$this->get_form_name().'_name_es', '', '', '', 1, 'text', 1, 60, 60);		$this->m_form_object->add_inputs($obj,$obj->get_id());		$obj = new Cform_text('name_ca',$this->get_form_name().'_name_ca', '', '', '', 1, 'text', 1, 60, 60);		$this->m_form_object->add_inputs($obj,$obj->get_id());		$obj = new Cform_text('name_en',$this->get_form_name().'_name_en', '', '', '', 1, 'text', 1, 60, 60);		$this->m_form_object->add_inputs($obj,$obj->get_id());		$obj = new Cform_hidden('categoria_id',$this->get_form_name().'_categoria_id', '', '', $this->m_relation_id, 200, 'text', 1 );		$this->m_form_object->add_inputs($obj,$obj->get_id());		if ($this->m_type == 'edit'){			$obj = new Cform_hidden('item_id', $this->get_form_name().'_item_id', '', '', $this->m_item_id); 			$this->m_form_object->add_inputs($obj,$obj->get_id()); 		}		$obj = new Cform_hidden('return',$this->get_form_name().'_return', '', '', $this->m_return, 200, 'text', 1);		$this->m_form_object->add_inputs($obj,$obj->get_id());		$obj = new Cform_button_submit('submit',$this->get_form_name().'_submit','Enviar'); 		$this->m_form_object->add_inputs($obj,$obj->get_id()); 		$this->m_form_object->close_form(); 		// si es un edit llenamos los objetos con los campos de la base de datos		if ($this->get_type() == 'edit' and $fillbd){			$this->search_and_fill_object_from_bd();		}	} 	function process(){		if (!isset($_POST[$this->m_form_name.'_submit'])){			$this->populate();		}else{			//Creamos el formulario y le asignamos los valores			$this->get_and_fill_submited_params();			//validamos el formulario			if ($this->validate()){				//obtenemos los valores del formulario para hacer el save				$item = $this->fill_array_to_save();				if ($this->m_type == 'new'){					//creamos el objeto cusers					$newitem = new Ccategoria_gallery('', $item['name_es'], $item['name_ca'], $item['name_en'], $item['categoria_id']);					//Si es un stripped hemos de mirar ke no ete creado ya en la BD					if (! $newitem->is_unique($item['name_es'], $item['name_ca'], $item['name_en'], $item['categoria_id']) ){						$this->set_info_action_form_failed('Ya hay un item creado con estos datos', 0); 						Clocation::header_location('/admin/categoria_gallery/list/'.$item['return'].'/');						exit(); 					}					// guardamos el objeto					if ($newitem->save()){						$this->set_info_action_form_success('Item guardado correctamente', 0); 					}else {						$this->set_info_action_form_failed('Error creando el item', 0); 					}					Clocation::header_location('/admin/categoria_gallery/list/'.$item['return'].'/');					exit(); 				}else if ($this->m_type == 'edit'){//fi type==new					//Obtenemos el objeto					$edititem = new Ccategoria_gallery($item['item_id']);					$edititem->edit( $item['name_es'], $item['name_ca'], $item['name_en'], $item['categoria_id']);					// editamos el objeto					if ($edititem){						$this->set_info_action_form_success('Item editado correctamente', 0); 					}else {						$this->set_info_action_form_failed('Error editando el item', 0); 					}					Clocation::header_location('/admin/categoria_gallery/list/'.$item['return'].'/');					exit(); 				}//fi else type='edit'			}//fi validate		}//fi else _post	}//fin process	function search_and_fill_object_from_bd(){		// Buscamos en la base de datos los usuarios		$item = new Ccategoria_gallery($this->get_item_id()); 		$resultat = $item->load_item_to_array(); 		// Llenamos el objeto formulario con los valores de la bd		$this->fill_object_from_bd($resultat);	}//fin search_and_fill}?>